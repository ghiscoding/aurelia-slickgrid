(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{uEsh:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var r=i("oVLv");class s{constructor(){this._odataOptions={filterQueue:[],orderBy:""},this._defaultSortBy="",this._columnFilters={}}buildQuery(){if(!this._odataOptions)throw new Error('Odata Service requires certain options like "top" for it to work');this._odataOptions.filterQueue=[];const t=[];if(this._odataOptions&&!0===this._odataOptions.enableCount){const e=this._odataOptions.version&&this._odataOptions.version>=4?"$count=true":"$inlinecount=allpages";t.push(e)}if(this._odataOptions.top&&t.push("$top="+this._odataOptions.top),this._odataOptions.skip&&t.push("$skip="+this._odataOptions.skip),this._odataOptions.orderBy){let e="";e=Array.isArray(this._odataOptions.orderBy)?this._odataOptions.orderBy.join(","):this._odataOptions.orderBy,t.push("$orderby="+e)}if(this._odataOptions.filterBy||this._odataOptions.filter){const t=this._odataOptions.filter||this._odataOptions.filterBy;if(t){this._filterCount=1,this._odataOptions.filterQueue=[];let e=t;Array.isArray(t)&&(this._filterCount=t.length,e=t.join(` ${this._odataOptions.filterBySeparator||"and"} `)),"string"==typeof e&&("("!==e[0]||")"!==e.slice(-1)?this.addToFilterQueueWhenNotExists(`(${e})`):this.addToFilterQueueWhenNotExists(e))}}if(this._odataOptions.filterQueue.length>0){const e=this._odataOptions.filterQueue.join(` ${this._odataOptions.filterBySeparator||"and"} `);this._odataOptions.filter=e,t.push("$filter="+e)}return t.join("&")}getFilterCount(){return this._filterCount}get columnFilters(){return this._columnFilters}get options(){return this._odataOptions}set options(t){this._odataOptions=t}removeColumnFilter(t){this._columnFilters&&this._columnFilters.hasOwnProperty(t)&&delete this._columnFilters[t]}saveColumnFilter(t,e,i){this._columnFilters[t]={search:i,value:e}}updateOptions(t){for(const e of Object.keys(t))if(t.hasOwnProperty(e)&&(this._odataOptions[e]=t[e]),"orderBy"===e||"sortBy"===e){let i=t[e];this._odataOptions.caseType===r.a.pascalCase&&(Array.isArray(i)?i.forEach((t,e,i)=>{i[e]=Object(r.g)(t)}):i=Object(r.g)(t[e])),this._odataOptions.orderBy=i,this._defaultSortBy=i}}addToFilterQueueWhenNotExists(t){this._odataOptions.filterQueue&&-1===this._odataOptions.filterQueue.indexOf(t)&&this._odataOptions.filterQueue.push(t)}}class o{constructor(){this._currentFilters=[],this._currentSorters=[],this.defaultOptions={top:25,orderBy:"",caseType:r.a.pascalCase},this._odataService=new s}get columnDefinitions(){return this._columnDefinitions}get odataService(){return this._odataService}get _gridOptions(){var t;return(null===(t=this._grid)||void 0===t?void 0:t.getOptions)?this._grid.getOptions():{}}init(t,e,i){this._grid=i;const r=Object.assign(Object.assign({},this.defaultOptions),t);if(this._gridOptions&&!this._gridOptions.enablePagination)this._odataService.options=Object.assign(Object.assign({},r),{top:void 0}),this._currentPagination=null;else{const t=e&&e.pageSize?e.pageSize:this.defaultOptions.top;this._odataService.options=Object.assign(Object.assign({},r),{top:t}),this._currentPagination={pageNumber:1,pageSize:this._odataService.options.top||this.defaultOptions.top||20}}this.options=this._odataService.options,this.pagination=e,(null==i?void 0:i.getColumns)&&(this._columnDefinitions=i.getColumns()||[],this._columnDefinitions=this._columnDefinitions.filter(t=>!t.excludeFromQuery))}buildQuery(){return this._odataService.buildQuery()}clearFilters(){this._currentFilters=[],this.updateFilters([])}clearSorters(){this._currentSorters=[],this.updateSorters([])}updateOptions(t){this.options=Object.assign(Object.assign({},this.options),t),this._odataService.options=this.options}removeColumnFilter(t){this._odataService.removeColumnFilter(t)}getCurrentFilters(){return this._currentFilters}getCurrentPagination(){return this._currentPagination}getCurrentSorters(){return this._currentSorters}mapOdataOperator(t){let e="";switch(t){case"<":e="lt";break;case"<=":e="le";break;case">":e="gt";break;case">=":e="ge";break;case"<>":case"!=":e="ne";break;case"=":case"==":default:e="eq"}return e}resetPaginationOptions(){this._odataService.updateOptions({skip:0})}saveColumnFilter(t,e,i){this._odataService.saveColumnFilter(t,e,i)}processOnFilterChanged(t,e){if(void 0===this._gridOptions.backendServiceApi)throw new Error('Something went wrong in the GridOdataService, "backendServiceApi" is not initialized');if(this._currentFilters=this.castFilterToColumnFilters(e.columnFilters),!e||!e.grid)throw new Error('Something went wrong when trying create the GridOdataService, it seems that "args" is not populated correctly');return this.updateFilters(e.columnFilters),this.resetPaginationOptions(),this._odataService.buildQuery()}processOnPaginationChanged(t,e){const i=+(e.pageSize||(this.pagination?this.pagination.pageSize:20));return this.updatePagination(e.newPage,i),this._odataService.buildQuery()}processOnSortChanged(t,e){const i=e.multiColumnSort?e.sortCols:new Array({columnId:e.sortCol.id,sortCol:e.sortCol,sortAsc:e.sortAsc});return this.updateSorters(i),this._odataService.buildQuery()}updateFilters(t,e){var i;let s="";const o=[],n=this._odataService&&this._odataService.options&&this._odataService.options.version||2;e&&(this._currentFilters=this.castFilterToColumnFilters(t));for(const a in t)if(t.hasOwnProperty(a)){const l=t[a];let c;if(c=e&&Array.isArray(this._columnDefinitions)?this._columnDefinitions.find(t=>t.id===l.columnId):l.columnDef,!c)throw new Error("[GridOData Service]: Something went wrong in trying to get the column definition of the specified filter (or preset filters). Did you make a typo on the filter columnId?");let d=(null===(i=c.filter)||void 0===i?void 0:i.queryField)||c.queryFieldFilter||c.queryField||c.field||c.name||"";const u=c.type||r.b.string;let h=(l?l.searchTerms:null)||[],p=Array.isArray(h)&&1===h.length?h[0]:"";if(void 0===p&&(p=""),!d)throw new Error('GridOData filter could not find the field name to query the search, your column definition must include a valid "field" or "name" (optionally you can also use the "queryfield").');p=""+p;const g=p.match(/^([<>!=\*]{0,2})(.*[^<>!=\*])([\*]?)$/);let f=l.operator||(g?g[1]:""),O=g?g[2]:"";const y=g?g[3]:"*z"===f||f===r.c.endsWith?"*":"",_=l.bypassBackendQuery||!1;if(d&&""===O&&h.length<=1){this.removeColumnFilter(d);continue}if(Array.isArray(h)&&1===h.length&&"string"==typeof h[0]&&h[0].indexOf("..")>0&&(h=h[0].split(".."),f||(f=r.c.rangeExclusive)),O=O.replace("'","''"),O=encodeURIComponent(O),!f&&c.filter&&(f=c.filter.operator),f||(f=Object(r.e)(c.type||r.b.string)),_)d&&this.saveColumnFilter(d,p,h);else{if(s="",this._odataService.options.caseType===r.a.pascalCase&&(d=Object(r.g)(d||"")),u===r.b.date)s=this.filterBySearchDate(d,f,h,n);else if(h&&h.length>1&&("IN"===f||"NIN"===f||"NOTIN"===f||"NOT IN"===f||"NOT_IN"===f)){const t=[];if("IN"===f){for(let e=0,i=h.length;e<i;e++)if(u===r.b.string||u===r.b.text||u===r.b.readonly){const i=encodeURIComponent(h[e].replace("'","''"));t.push(`${d} eq '${i}'`)}else t.push(`${d} eq ${h[e]}`);s=t.join(" or "),"string"==typeof s&&"("===s[0]&&")"===s.slice(-1)||(s=`(${s})`)}else{for(let e=0,i=h.length;e<i;e++){const i=encodeURIComponent(h[e].replace("'","''"));t.push(`${d} ne '${i}'`)}s=t.join(" and "),"string"==typeof s&&"("===s[0]&&")"===s.slice(-1)||(s=`(${s})`)}}else"*"===f||"a*"===f||"*z"===f||"*"===y||f===r.c.startsWith||f===r.c.endsWith?s="*"===f||"*z"===f||f===r.c.endsWith?`endswith(${d}, '${O}')`:`startswith(${d}, '${O}')`:u===r.b.string||u===r.b.text||u===r.b.readonly?""===f||f===r.c.contains||f===r.c.notContains?(s=this.odataQueryVersionWrapper("substring",n,d,O),f===r.c.notContains&&(s="not "+s)):s=f===r.c.rangeExclusive||f===r.c.rangeInclusive?this.filterBySearchTermRange(d,f,h):`${d} ${this.mapOdataOperator(f)} '${O}'`:f===r.c.rangeExclusive||f===r.c.rangeInclusive?s=this.filterBySearchTermRange(d,f,h):(O=u===r.b.number||u===r.b.boolean?O:`'${O}'`,s=`${d} ${this.mapOdataOperator(f)} ${O}`);""!==s&&(o.push(s.trim()),this.saveColumnFilter(d||"",p,O))}}this._odataService.updateOptions({filter:o.length>0?o.join(" and "):"",skip:void 0})}updatePagination(t,e){this._currentPagination={pageNumber:t,pageSize:e},!this._gridOptions||!this._gridOptions.enablePagination&&this._gridOptions.hasOwnProperty("enablePagination")||this._odataService.updateOptions({top:e,skip:(t-1)*e})}updateSorters(t,e){let i=[];const s=[];if(!t&&e){i=e,i.forEach(t=>t.direction=t.direction.toLowerCase());const t=i.map(t=>{const e=this._columnDefinitions.find(e=>e.id===t.columnId);return s.push({field:e?(e.queryFieldSorter||e.queryField||e.field)+"":t.columnId+"",direction:t.direction}),e?{columnId:t.columnId,sortAsc:t.direction.toUpperCase()===r.d.ASC}:null});Array.isArray(t)&&this._grid&&this._grid.setSortColumns(t)}else if(t&&!e)if(t&&0===t.length);else if(t)for(const e of t)if(e.sortCol){let t=(e.sortCol.queryFieldSorter||e.sortCol.queryField||e.sortCol.field)+"",o=(e.sortCol.field||e.sortCol.id)+"",n=(e.sortCol.queryFieldSorter||e.sortCol.queryField||e.sortCol.field||"")+"";this._odataService.options.caseType===r.a.pascalCase&&(t=Object(r.g)(t),o=Object(r.g)(o),n=Object(r.g)(n)),""!==o&&i.push({columnId:o,direction:e.sortAsc?"asc":"desc"}),""!==n&&s.push({field:n,direction:e.sortAsc?r.d.ASC:r.d.DESC})}i=i||[];const o=s.map(t=>{let e="";if(t&&t.field){e=`${this._odataService.options.caseType===r.a.pascalCase?Object(r.g)(t.field):t.field} ${t&&t.direction&&t.direction.toLowerCase()||""}`}return e}).join(",");return this._odataService.updateOptions({orderBy:o}),this._currentSorters=i,this._odataService.buildQuery()}castFilterToColumnFilters(t){const e="object"==typeof t?Object.keys(t).map(e=>t[e]):t;return Array.isArray(e)?e.map(t=>{const e={columnId:t.columnId||""};return t.operator&&(e.operator=t.operator),Array.isArray(t.searchTerms)&&(e.searchTerms=t.searchTerms),e}):[]}odataQueryVersionWrapper(t,e,i,r=""){let s="";switch(t){case"dateTime":s=e>=4?r:`DateTime'${r}'`;break;case"substring":s=e>=4?`contains(${i}, '${r}')`:`substringof('${r}', ${i})`}return s}filterBySearchDate(t,e,i,s){let o="",n=[];if(Array.isArray(i)&&i.length>1&&(n=i,e!==r.c.rangeExclusive&&e!==r.c.rangeInclusive&&this._gridOptions.defaultFilterRangeOperator&&(e=this._gridOptions.defaultFilterRangeOperator)),0===n.length&&Array.isArray(i)&&1===i.length&&i[0]){const o=this.odataQueryVersionWrapper("dateTime",s,t,Object(r.f)(i[0],!0));if(o)return`${t} ${this.mapOdataOperator(e)} ${o}`}if(Array.isArray(n)&&2===n.length&&n[0]&&n[1]){const i=this.odataQueryVersionWrapper("dateTime",s,t,Object(r.f)(n[0],!0)),a=this.odataQueryVersionWrapper("dateTime",s,t,Object(r.f)(n[1],!0));i&&a&&(e===r.c.rangeInclusive?o=`(${t} ge ${i} and ${t} le ${a})`:e===r.c.rangeExclusive&&(o=`(${t} gt ${i} and ${t} lt ${a})`))}return o}filterBySearchTermRange(t,e,i){let s="";return Array.isArray(i)&&2===i.length&&(e===r.c.rangeInclusive?s=`(${t} ge ${i[0]} and ${t} le ${i[1]})`:e===r.c.rangeExclusive&&(s=`(${t} gt ${i[0]} and ${t} lt ${i[1]})`)),s}}}}]);
//# sourceMappingURL=vendors~f0014c2d.5848649bde0d30e24de7.bundle.map