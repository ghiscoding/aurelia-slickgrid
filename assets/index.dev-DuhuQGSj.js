import{a6 as w,r as y,a7 as b,a8 as m,a9 as _}from"./index-Bz3uuwsZ.js";function z(s,e){return JSON.stringify(s!==void 0?s:{},e)}class q{constructor(){this.baseUrl="",this.defaults={},this.interceptors=[],this.dispatcher=null,this._container=y(m)}withBaseUrl(e){return this.baseUrl=e,this}withDefaults(e){return this.defaults=e,this}withInterceptor(e){return this.interceptors.push(e),this}useStandardConfiguration(){const e={credentials:"same-origin"};return Object.assign(this.defaults,e,this.defaults),this.rejectErrorResponses()}rejectErrorResponses(){return this.withInterceptor({response:v})}withRetry(e){const t=this._container.invoke(g,[e]);return this.withInterceptor(t)}withDispatcher(e){return this.dispatcher=e,this}}function v(s){if(!s.ok)throw s;return s}const u=(s,...e)=>new Error(`AUR${String(s).padStart(4,"0")}: ${x(s,...e)}`),I={99:"Method {{0}} not implemented",5e3:"Could not resolve fetch function. Please provide a fetch function implementation or a polyfill for the global fetch function.",5001:"The config callback did not return a valid HttpClientConfiguration like instance. Received {{0}}",5002:"invalid config, expecting a function or an object, received {{0}}",5004:"Only one RetryInterceptor is allowed.",5005:"The retry interceptor must be the last interceptor defined.",5003:"Default headers must be a plain object.",5006:"An invalid result was returned by the interceptor chain. Expected a Request or Response instance, but got [{{{0}}]",5007:"An interval less than or equal to 1 second is not allowed when using the exponential retry strategy. Received: {{0}}",5008:"Invalid retry strategy: {{0}}"},x=(s,...e)=>{var n;let t=I[s];for(let r=0;r<e.length;++r){const i=new RegExp(`{{${r}(:.*)?}}`,"g");let a=i.exec(t);for(;a!=null;){const c=(n=a[1])==null?void 0:n.slice(1);let o=e[r];if(o!=null)switch(c){case"join(!=)":o=o.join("!=");break;case"element":o=o==="*"?"all elements":`<${o} />`;break;default:c!=null&&c.startsWith(".")?o=String(o[c.slice(1)]):o=String(o)}t=t.slice(0,a.index)+o+t.slice(i.lastIndex),a=i.exec(t)}}return t},E=/^([a-z][a-z0-9+\-.]*:)?\/\//i,j=w.createInterface("fetch",s=>{if(typeof fetch!="function")throw u(5e3);return s.instance(fetch)}),M=w.createInterface("IHttpClient",s=>s.aliasTo(H));class H{constructor(){this.activeRequestCount=0,this.isRequesting=!1,this.isConfigured=!1,this.baseUrl="",this.defaults=null,this._interceptors=[],this._dispatcher=null,this._createConfiguration=y(b(q)),this._fetchFn=y(j)}get interceptors(){return this._interceptors.slice(0)}configure(e){let t;if(typeof e=="object")t={defaults:e};else if(typeof e=="function"){t=this._createConfiguration(),t.baseUrl=this.baseUrl,t.defaults={...this.defaults},t.interceptors=this._interceptors,t.dispatcher=this._dispatcher;const i=e(t);if(i!=null)if(typeof i=="object")t=i;else throw u(5001,typeof i)}else throw u(5002,typeof e);const n=t.defaults;if((n==null?void 0:n.headers)instanceof Headers)throw u(5003);const r=t.interceptors;if((r==null?void 0:r.length)>0){if(r.filter(a=>a instanceof g).length>1)throw u(5004);const i=r.findIndex(a=>a instanceof g);if(i>=0&&i!==r.length-1)throw u(5005)}return this.baseUrl=t.baseUrl,this.defaults=n,this._interceptors=t.interceptors??[],this._dispatcher=t.dispatcher,this.isConfigured=!0,this}fetch(e,t){this._trackRequestStart();let n=this.buildRequest(e,t);return this.processRequest(n,this._interceptors).then(r=>{let i;if(r instanceof Response)i=Promise.resolve(r);else if(r instanceof Request)n=r,i=this._fetchFn.call(void 0,n);else throw u(5006,r);return this.processResponse(i,this._interceptors,n)}).then(r=>r instanceof Request?this.fetch(r):r).then(r=>(this._trackRequestEnd(),r),r=>{throw this._trackRequestEnd(),r})}buildRequest(e,t){const n=this.defaults??{};let r,i,a;const c=T(n.headers);if(e instanceof Request)r=e,a=new Headers(r.headers).get("Content-Type");else{t||(t={}),i=t.body;const l={...n,headers:{},...t,...i!==void 0?{body:i}:null};a=new Headers(l.headers).get("Content-Type"),r=new Request(k(this.baseUrl,e),l)}return a||(new Headers(c).has("content-type")?(console.warn('Request was created with header "content-type", converted to "Content-Type" instead.'),r.headers.set("Content-Type",new Headers(c).get("content-type"))):i!==void 0&&S(i)&&r.headers.set("Content-Type","application/json")),O(r.headers,c),i instanceof Blob&&i.type&&r.headers.set("Content-Type",i.type),r}get(e,t){return this.fetch(e,t)}post(e,t,n){return this._callFetch(e,t,n,"POST")}put(e,t,n){return this._callFetch(e,t,n,"PUT")}patch(e,t,n){return this._callFetch(e,t,n,"PATCH")}delete(e,t,n){return this._callFetch(e,t,n,"DELETE")}dispose(){this._interceptors.forEach(e=>{var t;return(t=e.dispose)==null?void 0:t.call(e)}),this._interceptors.length=0,this._dispatcher=null}_trackRequestStart(){this.isRequesting=!!++this.activeRequestCount,this.isRequesting&&this._dispatcher!=null&&R(this._dispatcher,C.started)}_trackRequestEnd(){this.isRequesting=!!--this.activeRequestCount,!this.isRequesting&&this._dispatcher!=null&&R(this._dispatcher,C.drained)}processRequest(e,t){return this._applyInterceptors(e,t,"request","requestError",Request,this)}processResponse(e,t,n){return this._applyInterceptors(e,t,"response","responseError",Response,n,this)}_applyInterceptors(e,t,n,r,i,...a){return(t??[]).reduce((c,o)=>{const l=o[n],d=o[r];return c.then(l?f=>f instanceof i?l.call(o,f,...a):f:U,d?f=>d.call(o,f,...a):P)},Promise.resolve(e))}_callFetch(e,t,n,r){return n||(n={}),n.method=r,t!=null&&(n.body=t),this.fetch(e,n)}}function T(s){const e={},t=s??{};for(const n of Object.keys(t))e[n]=typeof t[n]=="function"?t[n]():t[n];return e}function k(s,e){return E.test(e)?e:(s??"")+e}function O(s,e){const t=e??{};for(const n of Object.keys(t))s.has(n)||s.set(n,t[n])}function S(s){try{JSON.parse(s)}catch{return!1}return!0}function U(s){return s}function P(s){throw s}function R(s,e){const t=new s.ownerDocument.defaultView.CustomEvent(e,{bubbles:!0,cancelable:!0});setTimeout(()=>{s.dispatchEvent(t)},1)}const C=Object.freeze({started:"aurelia-fetch-client-request-started",drained:"aurelia-fetch-client-requests-drained"}),h=Object.freeze({fixed:0,incremental:1,exponential:2,random:3}),D={maxRetries:3,interval:1e3,strategy:h.fixed};class g{constructor(e){if(this.p=y(_),this.retryConfig={...D,...e??{}},this.retryConfig.strategy===h.exponential&&this.retryConfig.interval<=1e3)throw u(5007,this.retryConfig.interval)}request(e){return e.retryConfig||(e.retryConfig={...this.retryConfig},e.retryConfig.counter=0),e.retryConfig.requestClone=e.clone(),e}response(e,t){return delete t.retryConfig,e}responseError(e,t,n){const{retryConfig:r}=t,{requestClone:i}=r;return Promise.resolve().then(()=>{if(r.counter<r.maxRetries){const a=r.doRetry!=null?r.doRetry(e,t):!0;return Promise.resolve(a).then(c=>{if(c){r.counter++;const o=F(r);return new Promise(l=>this.p.setTimeout(l,isNaN(o)?0:o)).then(()=>{const l=i.clone();return typeof r.beforeRetry=="function"?r.beforeRetry(l,n):l}).then(l=>{const d={...l,retryConfig:r};return n.fetch(d)})}throw delete t.retryConfig,e})}throw delete t.retryConfig,e})}}function F(s){const{interval:e,strategy:t,minRandomInterval:n,maxRandomInterval:r,counter:i}=s;if(typeof t=="function")return s.strategy(i);switch(t){case h.fixed:return p[h.fixed](e);case h.incremental:return p[h.incremental](i,e);case h.exponential:return p[h.exponential](i,e);case h.random:return p[h.random](i,e,n,r);default:throw u(5008,t)}}const p=[s=>s,(s,e)=>e*s,(s,e)=>s===1?e:e**s/1e3,(s,e,t=0,n=6e4)=>Math.random()*(n-t)+t];export{M as I,z as j};
//# sourceMappingURL=index.dev-DuhuQGSj.js.map
