import{x as N,X as S,aC as C,aD as L,aE as P,aF as A,W as w,P as x,aG as R}from"./index-xBMUucNl.js";const b=["title","data-slick-tooltip"],y="[title], [data-slick-tooltip]",F="slick-custom-tooltip";class v{constructor(){this.name="CustomTooltip",this._cellType="slick-cell",this._rxjs=null,this._sharedService=null,this._mousePosition={x:0,y:0},this._hasMultipleTooltips=!1,this._defaultOptions={bodyClassName:"tooltip-body",className:"",offsetArrow:3,offsetLeft:0,offsetRight:0,offsetTopBottom:4,hideArrow:!1,regularTooltipWhiteSpace:"pre-line",whiteSpace:"normal"},this._eventHandler=new N}get addonOptions(){return this._addonOptions}get cancellablePromise(){return this._cancellablePromise}get cellAddonOptions(){return this._cellAddonOptions}get bodyClassName(){var t;return((t=this._cellAddonOptions)==null?void 0:t.bodyClassName)??"tooltip-body"}get className(){var i;let t=F;return(i=this._addonOptions)!=null&&i.className&&(t+=` ${this._addonOptions.className}`),t}get dataView(){return this._grid.getData()||{}}get gridOptions(){var t;return((t=this._grid)==null?void 0:t.getOptions())||{}}get gridUid(){var t;return((t=this._grid)==null?void 0:t.getUID())||""}get gridUidSelector(){return this.gridUid?`.${this.gridUid}`:""}get tooltipElm(){return this._tooltipElm}addRxJsResource(t){this._rxjs=t}init(t,i){var e,s;this._grid=t,this._rxjs=i.get("RxJsFacade"),this._sharedService=i.get("SharedService"),this._addonOptions={...this._defaultOptions,...(s=(e=this._sharedService)==null?void 0:e.gridOptions)==null?void 0:s.customTooltip},this._eventHandler.subscribe(t.onMouseEnter,this.handleOnMouseOver.bind(this)).subscribe(t.onHeaderMouseOver,(o,l)=>this.handleOnHeaderMouseOverByType(o,l,"slick-header-column")).subscribe(t.onHeaderRowMouseEnter,(o,l)=>this.handleOnHeaderMouseOverByType(o,l,"slick-headerrow-column")).subscribe(t.onHeaderRowMouseOver,(o,l)=>this.handleOnHeaderMouseOverByType(o,l,"slick-headerrow-column")).subscribe(t.onMouseLeave,this.hideTooltip.bind(this)).subscribe(t.onHeaderMouseOut,this.hideTooltip.bind(this)).subscribe(t.onHeaderRowMouseLeave,this.hideTooltip.bind(this)).subscribe(t.onHeaderRowMouseOut,this.hideTooltip.bind(this))}dispose(){this.hideTooltip(),this._cancellablePromise=void 0,this._eventHandler.unsubscribeAll()}hideTooltip(){var e,s;(e=this._cancellablePromise)==null||e.cancel(),(s=this._observable$)==null||s.unsubscribe();const t=S(this.className).join("."),i=document.body.querySelector(`.${t}${this.gridUidSelector}`);i==null||i.remove()}getOptions(){return this._addonOptions}setOptions(t){this._addonOptions={...this._addonOptions,...t}}asyncProcessCallback(t,i,e,s,o){var n,r;this.hideTooltip();const l={...o,[((n=this.addonOptions)==null?void 0:n.asyncParamsPropName)??"__params"]:t};(r=this._cellAddonOptions)!=null&&r.useRegularTooltip?this.renderRegularTooltip(this._cellAddonOptions.asyncPostFormatter,i,e,s,l):this.renderTooltipFormatter(this._cellAddonOptions.asyncPostFormatter,i,e,s,l)}handleOnHeaderMouseOverByType(t,i,e){var r,a,u,f;this._cellType=e,this._mousePosition={x:t.clientX||0,y:t.clientY||0},this._mouseTarget=(r=document.elementFromPoint(t.clientX||0,t.clientY||0))==null?void 0:r.closest(y),this.hideTooltip();const s={row:-1,cell:this._grid.getColumns().findIndex(d=>{var c;return(((c=i==null?void 0:i.column)==null?void 0:c.id)??"")===d.id})},o=i.column,l={},n=e==="slick-headerrow-column";if(i||(i={}),i.cell=s.cell,i.row=s.row,i.columnDef=o,i.dataContext=l,i.grid=this._grid,i.type=n?"header-row":"header",this._cellAddonOptions={...this._addonOptions,...o==null?void 0:o.customTooltip},!(o!=null&&o.disableTooltip||typeof((a=this._cellAddonOptions)==null?void 0:a.usabilityOverride)=="function"&&!this._cellAddonOptions.usabilityOverride(i))&&o&&t.target){this._cellNodeElm=t.target.closest(`.${e}`);const d=n?this._cellAddonOptions.headerRowFormatter:this._cellAddonOptions.headerFormatter;if((u=this._cellAddonOptions)!=null&&u.useRegularTooltip||!d){const c=n?(f=this._cellAddonOptions)!=null&&f.useRegularTooltip?null:d:o.name;this.renderRegularTooltip(c,s,null,o,l)}else this._cellNodeElm&&typeof d=="function"&&this.renderTooltipFormatter(d,s,null,o,l)}}async handleOnMouseOver(t){var i,e,s,o,l,n,r,a,u;if(this._cellType="slick-cell",this._mousePosition={x:t.clientX||0,y:t.clientY||0},this._mouseTarget=(i=document.elementFromPoint(t.clientX||0,t.clientY||0))==null?void 0:i.closest(y),this.hideTooltip(),t&&this._grid){const f=(s=(e=t==null?void 0:t.target)==null?void 0:e.closest(".slick-cell"))==null?void 0:s.className,d=f&&/l\d+/.exec(f||"")?this._grid.getCellFromEvent(t):null;if(d){const c=this.dataView?this.dataView.getItem(d.row):this._grid.getDataItem(d.row),h=this._grid.getColumns()[d.cell];if(this._cellNodeElm=this._grid.getCellNode(d.row,d.cell),c&&h){if(this._cellAddonOptions={...this._addonOptions,...h==null?void 0:h.customTooltip},h!=null&&h.disableTooltip||typeof((o=this._cellAddonOptions)==null?void 0:o.usabilityOverride)=="function"&&!this._cellAddonOptions.usabilityOverride({cell:d.cell,row:d.row,dataContext:c,column:h,grid:this._grid,type:"cell"}))return;const _=c.hasOwnProperty(h.field)?c[h.field]:null,O=this._grid.getEditorLock().isActive()?null:_;if(this._cellAddonOptions.useRegularTooltip&&!((l=this._cellAddonOptions)!=null&&l.asyncProcess)||!((n=this._cellAddonOptions)!=null&&n.formatter))this.renderRegularTooltip(h.formatter,d,O,h,c);else if(typeof((r=this._cellAddonOptions)==null?void 0:r.formatter)=="function"&&this.renderTooltipFormatter(this._cellAddonOptions.formatter,d,O,h,c),typeof((a=this._cellAddonOptions)==null?void 0:a.asyncProcess)=="function"){const g=this._cellAddonOptions.asyncProcess(d.row,d.cell,_,h,c,this._grid);if(this._cellAddonOptions.asyncPostFormatter||console.error('[Slickgrid-Universal] when using "asyncProcess" with Custom Tooltip, you must also provide an "asyncPostFormatter" formatter.'),g instanceof Promise)this._cancellablePromise=C(g),this._cancellablePromise.promise.then(p=>this.asyncProcessCallback(p,d,_,h,c)).catch(p=>{p instanceof L||console.error(p)});else if((u=this._rxjs)!=null&&u.isObservable(g)){const p=this._rxjs;this._observable$=g.pipe(p.switchMap(m=>p.of(m))).subscribe(m=>this.asyncProcessCallback(m,d,_,h,c),m=>console.error(m))}}}}}}parseFormatterAndSanitize(t,i,e,s,o){if(typeof t=="function"){const l=t(i.row,i.cell,e,s,o,this._grid),n=P(l)?l:l.html||l.text;return this._grid.sanitizeHtmlString((n instanceof HTMLElement?n.textContent:n)||"")}else if(typeof t=="string")return this._grid.sanitizeHtmlString(t);return""}renderRegularTooltip(t,i,e,s,o){var u,f,d,c,h,_,O,g;const l=document.createElement("div");this._grid.applyHtmlCode(l,this.parseFormatterAndSanitize(t,i,e,s,o)),this._hasMultipleTooltips=(((u=this._cellNodeElm)==null?void 0:u.querySelectorAll(y).length)||0)>1;let n;const r=(f=this._cellAddonOptions)!=null&&f.useRegularTooltipFromCellTextOnly||!this._mouseTarget?this._cellNodeElm:this._mouseTarget;let a=(s==null?void 0:s.toolTip)??"";a||(this._cellType==="slick-cell"&&r&&r.clientWidth<r.scrollWidth&&!((d=this._cellAddonOptions)!=null&&d.useRegularTooltipFromFormatterOnly)?(a=((c=r.textContent)==null?void 0:c.trim())??"",(h=this._cellAddonOptions)!=null&&h.tooltipTextMaxLength&&a.length>((_=this._cellAddonOptions)==null?void 0:_.tooltipTextMaxLength)&&(a=a.substring(0,this._cellAddonOptions.tooltipTextMaxLength-3)+"..."),n=r):((O=this._cellAddonOptions)!=null&&O.useRegularTooltipFromFormatterOnly?n=l.querySelector(y):(n=A(r,b)?r:l.querySelector(y),(!n||!A(n,b))&&r&&(n=r.querySelector(y))),(n==null?void 0:n.style.display)==="none"||this._hasMultipleTooltips&&(!r||r===this._cellNodeElm)?a="":(!a||typeof t=="function"&&((g=this._cellAddonOptions)!=null&&g.useRegularTooltipFromFormatterOnly))&&(a=A(n,b)||""))),a!==""&&this.renderTooltipFormatter(t,i,e,s,o,a,n),this.swapAndClearTitleAttribute(n,a)}renderTooltipFormatter(t,i,e,s,o,l,n){var u,f,d,c,h,_,O,g,p;if(this._tooltipElm=w("div",{className:this.className}),this._tooltipBodyElm=w("div",{className:this.bodyClassName}),this._tooltipElm.classList.add(this.gridUid),this._tooltipElm.classList.add("l"+i.cell),this._tooltipElm.classList.add("r"+i.cell),(u=this.tooltipElm)==null||u.appendChild(this._tooltipBodyElm),e==null){const m=(f=this._cellNodeElm)==null?void 0:f.querySelector(y);e=A(m,b)||e}let r=l||this.parseFormatterAndSanitize(t,i,e,s,o)||"";r=(d=this._cellAddonOptions)!=null&&d.tooltipTextMaxLength&&r.length>this._cellAddonOptions.tooltipTextMaxLength?r.substring(0,this._cellAddonOptions.tooltipTextMaxLength-3)+"...":r;let a="";!l||(c=this._cellAddonOptions)!=null&&c.renderRegularTooltipAsHtml?(a=this._grid.sanitizeHtmlString(r),this._grid.applyHtmlCode(this._tooltipBodyElm,a),this._tooltipBodyElm.style.whiteSpace=((h=this._cellAddonOptions)==null?void 0:h.whiteSpace)??this._defaultOptions.whiteSpace):(a=r||"",this._tooltipBodyElm.textContent=a,this._tooltipBodyElm.style.whiteSpace=((_=this._cellAddonOptions)==null?void 0:_.regularTooltipWhiteSpace)??this._defaultOptions.regularTooltipWhiteSpace),(O=this._cellAddonOptions)!=null&&O.maxHeight&&(this._tooltipElm.style.maxHeight=`${this._cellAddonOptions.maxHeight}px`),(g=this._cellAddonOptions)!=null&&g.maxWidth&&(this._tooltipElm.style.maxWidth=`${this._cellAddonOptions.maxWidth}px`),a.toString()&&(document.body.appendChild(this._tooltipElm),this.reposition(i),(p=this._cellAddonOptions)!=null&&p.hideArrow||this._tooltipElm.classList.add("tooltip-arrow"),this.swapAndClearTitleAttribute(n,r))}reposition(t){var i,e,s,o,l,n,r,a,u,f;if(this._tooltipElm){this._cellNodeElm=this._cellNodeElm||this._grid.getCellNode(t.row,t.cell);const d=x(this._cellNodeElm),c=this._cellNodeElm.offsetWidth,h=this._tooltipElm.getBoundingClientRect().height,_=this._tooltipElm.getBoundingClientRect().width,O=document.body.offsetWidth||window.innerWidth;let g=(d.top||0)-this._tooltipElm.offsetHeight-(((i=this._cellAddonOptions)==null?void 0:i.offsetTopBottom)??0),p=(d.left||0)-(((e=this._cellAddonOptions)==null?void 0:e.offsetRight)??0);const m=((s=this._cellAddonOptions)==null?void 0:s.position)??"auto";let T="";if(m==="center"?(p+=c/2-_/2+(((o=this._cellAddonOptions)==null?void 0:o.offsetRight)??0),T="top-center",this._tooltipElm.classList.remove("arrow-left-align","arrow-right-align"),this._tooltipElm.classList.add("arrow-center-align")):m==="right-align"||(m==="auto"||m!=="left-align")&&p+_>O?(T="right",p-=_-c-(((l=this._cellAddonOptions)==null?void 0:l.offsetLeft)??0),this._tooltipElm.classList.remove("arrow-center-align","arrow-left-align"),this._tooltipElm.classList.add("arrow-right-align")):(T="left",this._tooltipElm.classList.remove("arrow-center-align","arrow-right-align"),this._tooltipElm.classList.add("arrow-left-align")),m==="bottom"||(m==="auto"||m!=="top")&&h>R(this._cellNodeElm).top?(g=(d.top||0)+(this.gridOptions.rowHeight??0)+(((n=this._cellAddonOptions)==null?void 0:n.offsetTopBottom)??0),T=`bottom-${T}`,this._tooltipElm.classList.remove("arrow-down"),this._tooltipElm.classList.add("arrow-up")):(T=`top-${T}`,this._tooltipElm.classList.remove("arrow-up"),this._tooltipElm.classList.add("arrow-down")),this._tooltipElm&&(this._hasMultipleTooltips||(r=this.cellAddonOptions)!=null&&r.repositionByMouseOverTarget)){const E=x(this._mouseTarget);T.includes("left")||T==="top-center"?p=E.left-(((a=this._addonOptions)==null?void 0:a.offsetArrow)??3):T.includes("right")&&(p=E.left-_+(((u=this._mouseTarget)==null?void 0:u.offsetWidth)??0)+(((f=this._addonOptions)==null?void 0:f.offsetArrow)??3))}this._tooltipElm.style.top=`${g}px`,this._tooltipElm.style.left=`${p}px`}}swapAndClearTitleAttribute(t,i){var o,l;let e;t&&(e=this._cellNodeElm&&(this._cellNodeElm.hasAttribute("title")&&this._cellNodeElm.getAttribute("title")?this._cellNodeElm:(o=this._cellNodeElm)==null?void 0:o.querySelector("[title]")));const s=t||this._cellNodeElm&&(this._cellNodeElm.hasAttribute("title")&&this._cellNodeElm.getAttribute("title")?this._cellNodeElm:(l=this._cellNodeElm)==null?void 0:l.querySelector("[title]"));s&&(s.setAttribute("data-slick-tooltip",i||""),s.hasAttribute("title")&&s.setAttribute("title",""),e!=null&&e.hasAttribute("title")&&e.setAttribute("title",""))}}export{v as S};
//# sourceMappingURL=slickCustomTooltip-BwjRI8RF.js.map
