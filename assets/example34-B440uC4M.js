import{C as de,b as y,F as k,a as T,aH as ue,W as me,c as pe}from"./index-BEnHDSQL.js";import{f as he}from"./chunk-IHAWQA3S-C2e_0_q3.js";import{A as $}from"./aggregators.index-CRi798JA.js";import{G as ge}from"./groupingFormatters.index-pL073kVK.js";const Q="example34",I=`<h2>
  \${title}
  <span class="float-end">
    <a style="font-size: 18px" target="_blank"
        href="https://github.com/ghiscoding/aurelia-slickgrid/blob/master/packages/demo/src/examples/slickgrid/example34.ts">
      <span class="mdi mdi-link-variant"></span> code
    </a>
  </span>
  <button
      class="ms-2 btn btn-outline-secondary btn-sm btn-icon"
      type="button"
      data-test="toggle-subtitle"
      click.trigger="toggleSubTitle()"
    >
      <span class="mdi mdi-information-outline" title="Toggle example sub-title details"></span>
    </button>
    <button class="btn btn-outline-secondary btn-sm btn-icon" click.trigger="toggleDarkMode()" data-test="toggle-dark-mode">
    <span class="mdi mdi-theme-light-dark"></span>
    <span>Toggle Dark Mode</span>
  </button>
</h2>

<div class="subtitle" innerhtml.bind="subTitle"></div>

<div class="trading-platform">
  <div class="row mb-4 simulation-form">
    <div class="col-sm-12 d-flex align-items-center">
      <div class="range">
        <label for="refreshRateRange" class="form-label me-1">Changes Rate(ms)</label>
        <input type="range" class="form-range" id="refreshRateRange" min="0" max="250" value.bind="refreshRate">
        <span class="refresh-rate">
          <input type="number" value.bind="refreshRate">
        </span>
      </div>
      <span class="ms-3 me-1">
        <button class="btn btn-outline-secondary btn-sm btn-icon" data-test="start-btn" click.trigger="startSimulation()">
          <li class="mdi mdi-play-circle-outline"></li> Start Simulation
        </button>
      </span>
      <span class="me-3">
        <button class="btn btn-outline-secondary btn-sm btn-icon" data-test="stop-btn" click.trigger="stopSimulation()">
          <li class="mdi mdi-stop-circle-outline"></li> Stop Simulation
        </button>
      </span>
      <span class="mx-1">
        <label for="change-per-cycle-input">Changes p/Cycle</label>
        <input type="number" id="change-per-cycle-input" value.bind="minChangePerCycle" max.bind="maxChangePerCycle">
        to
        <input type="number" value.bind="maxChangePerCycle" min.bind="minChangePerCycle">
      </span>
      <span class="ms-2">
        <label for="highlight-input">Highlight Duration(ms)</label>
        <input type="number" id="highlight-input" data-test="highlight-input" value.bind="highlightDuration">
      </span>
      <div class="ms-auto">
        <button class="btn btn-outline-secondary btn-sm btn-icon" click.trigger="toggleFullScreen()">
          <li class.bind="isFullScreen ? 'mdi mdi-arrow-collapse' : 'mdi mdi-arrow-expand'"></li> Toggle Full-Screen
        </button>
      </div>
    </div>
  </div>

  <aurelia-slickgrid grid-id="grid34" column-definitions.bind="columnDefinitions" grid-options.bind="gridOptions"
                      dataset.bind="dataset" instances.bind="aureliaGrid">
  </aurelia-slickgrid>
</div>
`,V=[],X={};let j;function fe(n){j||(j=de.define({name:Q,template:I,dependencies:V,bindables:X})),n.register(j)}const be=Object.freeze(Object.defineProperty({__proto__:null,bindables:X,default:I,dependencies:V,name:Q,register:fe,template:I},Symbol.toStringTag,{value:"Module"}));function ye(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var H,U;function ve(){return U||(U=1,H=function(n){var t={};function e(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return n[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=n,e.c=t,e.d=function(i,r,o){e.o(i,r)||Object.defineProperty(i,r,{enumerable:!0,get:o})},e.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},e.t=function(i,r){if(1&r&&(i=e(i)),8&r||4&r&&typeof i=="object"&&i&&i.__esModule)return i;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:i}),2&r&&typeof i!="string")for(var l in i)e.d(o,l,(function(s){return i[s]}).bind(null,l));return o},e.n=function(i){var r=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(r,"a",r),r},e.o=function(i,r){return Object.prototype.hasOwnProperty.call(i,r)},e.p="",e(e.s=1)}([function(n,t,e){var i=e(2),r=e(3),o=e(4);n.exports=function(l){return i(l)||r(l)||o()}},function(n,t,e){e.r(t),e.d(t,"sparkline",function(){return u});var i=e(0),r=e.n(i);function o(a,c,d,p){return parseFloat((c-p*c/a+d).toFixed(2))}function l(a){return a.value}function s(a,c){var d=document.createElementNS("http://www.w3.org/2000/svg",a);for(var p in c)d.setAttribute(p,c[p]);return d}function u(a,c,d){var p;if(p=a,r()(p.querySelectorAll("*")).forEach(function(h){return p.removeChild(h)}),!(c.length<=1)){d=d||{},typeof c[0]=="number"&&(c=c.map(function(h){return{value:h}}));var f=d.onmousemove,v=d.onmouseout,ee="interactive"in d?d.interactive:!!f,M=d.spotRadius||2,S=2*M,te=d.cursorWidth||2,E=parseFloat(a.attributes["stroke-width"].value),re=d.fetch||l,D=c.map(function(h){return re(h)}),ie=parseFloat(a.attributes.width.value)-2*S,P=parseFloat(a.attributes.height.value),B=P-2*E-S,L=Math.max.apply(Math,r()(D)),b=-1e3,z=D.length-1,ae=ie/z,_=[],ne=o(L,B,E+M,D[0]),O="M".concat(S," ").concat(ne);D.forEach(function(h,C){var g=C*ae+S,w=o(L,B,E+M,h);_.push(Object.assign({},c[C],{index:C,x:g,y:w})),O+=" L ".concat(g," ").concat(w)});var oe=s("path",{class:"sparkline--line",d:O,fill:"none"}),se=s("path",{class:"sparkline--fill",d:"".concat(O," V ").concat(P," L ").concat(S," ").concat(P," Z"),stroke:"none"});if(a.appendChild(se),a.appendChild(oe),ee){var x=s("line",{class:"sparkline--cursor",x1:b,x2:b,y1:0,y2:P,"stroke-width":te}),F=s("circle",{class:"sparkline--spot",cx:b,cy:b,r:M});a.appendChild(x),a.appendChild(F);var A=s("rect",{width:a.attributes.width.value,height:a.attributes.height.value,style:"fill: transparent; stroke: transparent",class:"sparkline--interaction-layer"});a.appendChild(A),A.addEventListener("mouseout",function(h){x.setAttribute("x1",b),x.setAttribute("x2",b),F.setAttribute("cx",b),v&&v(h)}),A.addEventListener("mousemove",function(h){var C=h.offsetX,g=_.find(function(ce){return ce.x>=C});g||(g=_[z]);var w,N=_[_.indexOf(g)-1],G=(w=N?N.x+(g.x-N.x)/2<=C?g:N:g).x,le=w.y;F.setAttribute("cx",G),F.setAttribute("cy",le),x.setAttribute("x1",G),x.setAttribute("x2",G),f&&f(h,w)})}}}t.default=u},function(n,t){n.exports=function(e){if(Array.isArray(e)){for(var i=0,r=new Array(e.length);i<e.length;i++)r[i]=e[i];return r}}},function(n,t){n.exports=function(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}},function(n,t){n.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}}])),H}var Ce=ve();const we=ye(Ce);var Se=Object.create,q=Object.defineProperty,_e=Object.getOwnPropertyDescriptor,xe=(n,t)=>(t=Symbol[n])?t:Symbol.for("Symbol."+n),Y=n=>{throw TypeError(n)},Z=(n,t,e)=>t in n?q(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,ke=(n,t)=>q(n,"name",{value:t,configurable:!0}),Te=n=>[,,,Se(null)],Me=["class","method","getter","setter","accessor","field","value","get","set"],J=n=>n!==void 0&&typeof n!="function"?Y("Function expected"):n,De=(n,t,e,i,r)=>({kind:Me[n],name:t,metadata:i,addInitializer:o=>e._?Y("Already initialized"):r.push(J(o||null))}),Pe=(n,t)=>Z(t,xe("metadata"),n[3]),Fe=(n,t,e,i)=>{for(var r=0,o=n[t>>1],l=o&&o.length;r<l;r++)o[r].call(e);return i},Ne=(n,t,e,i,r,o)=>{var l,s,u,a=t&7,c=!1,d=0,p=n[d]||(n[d]=[]),f=a&&(r=r.prototype,a<5&&(a>3||!c)&&_e(r,e));ke(r,e);for(var v=i.length-1;v>=0;v--)u=De(a,e,s={},n[3],p),l=(0,i[v])(r,u),s._=1,J(l)&&(r=l);return Pe(n,r),f&&q(r,e,f),c?a^4?o:f:r},m=(n,t,e)=>Z(n,typeof t!="symbol"?t+"":t,e),K,W;const Ee=200,Oe=(n,t,e)=>`<img src="https://flags.fmcdn.net/data/flags/mini/${e.substring(0,2).toLowerCase()}.png" width="20"/> ${e}`,Ae=(n,t,e,i,r)=>{const o=r.priceChange>=0?"up":"down",l=new DocumentFragment,s=document.createElement("div");s.className=`d-inline-flex align-items-center text-${o==="up"?"success":"danger"}`;const u=document.createElement("span");return u.className=`mdi mdi-arrow-${o}`,s.appendChild(u),l.appendChild(s),e instanceof HTMLElement?s.appendChild(e):s.appendChild(document.createTextNode(e)),l},Ge=(n,t,e)=>`<div class="d-inline-flex align-items-center"><span class="me-1 mdi mdi-16px mdi-${e==="Buy"?"plus":"minus"}-circle ${e==="Buy"?"text-info":"text-warning"}"></span> ${e}</div>`,$e=(n,t,e,i,r)=>{if(r.historic.length<2)return"";const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"width","135"),o.setAttributeNS(null,"height","30"),o.setAttributeNS(null,"stroke-width","2"),o.classList.add("sparkline"),we(o,r.historic,{cursorwidth:2,onmousemove:(s,u)=>{const a=s.target.closest("svg"),c=a==null?void 0:a.nextElementSibling;c&&(c.hidden=!1,c.textContent=`$${(u.value*100/100).toFixed(2)}`,c.style.top=`${s.offsetY}px`,c.style.left=`${s.offsetX+20}px`)},onmouseout:s=>{const u=s.target.closest("svg"),a=u==null?void 0:u.nextElementSibling;a&&(a.hidden=!0)}});const l=document.createElement("div");return l.appendChild(o),l.appendChild(me("div",{className:"trading-tooltip",hidden:!0})),l};K=[pe(be)];class R{constructor(){m(this,"_darkMode",!1),m(this,"title","Example 34: Real-Time Trading Platform"),m(this,"subTitle",`Simulate a stock trading platform with lot of price changes, it is strongly suggested to disable the <code>autoResize.autoHeight</code> grid option for this type of grid.
    <ul>
      <li>you can start/stop the simulation, you can see SlickGrid huge perf by setting: (1) lower Changes Rate, (2) increase both Changes per Cycle, and (3) lower Highlight Duration</li>
      <li>optionally change random numbers, between 0 and 10 symbols, per cycle (higher numbers means more changes)</li>
      <li>optionally change the simulation changes refresh rate in ms (lower number means more changes).</li>
      <li>you can Group by 1 of these columns: Currency, Market or Type</li>
    </ul>`),m(this,"aureliaGrid"),m(this,"gridOptions"),m(this,"columnDefinitions",[]),m(this,"dataset",[]),m(this,"hideSubTitle",!1),m(this,"isFullScreen",!1),m(this,"highlightDuration",150),m(this,"itemCount",200),m(this,"minChangePerCycle",0),m(this,"maxChangePerCycle",10),m(this,"refreshRate",75),m(this,"timer"),this.defineGrid()}attached(){this.getData(),window.setTimeout(()=>{this.startSimulation()},this.refreshRate)}detaching(){this.stopSimulation(),document.querySelector(".panel-wm-content").classList.remove("dark-mode"),document.querySelector("#demo-container").dataset.bsTheme="light"}defineGrid(){this.columnDefinitions=[{id:"currency",name:"Currency",field:"currency",filterable:!0,sortable:!0,minWidth:65,width:65,formatter:Oe,filter:{model:y.singleSelect,collection:[{label:"",value:""},{label:"CAD",value:"CAD"},{label:"USD",value:"USD"}]},grouping:{getter:"currency",formatter:t=>`Currency: <span style="color: var(--slick-primary-color); font-weight: bold;">${t.value}</span>  <span style="color: #659bff;">(${t.count} items)</span>`,aggregators:[new $.Sum("amount")],aggregateCollapsed:!0,collapsed:!1}},{id:"symbol",name:"Symbol",field:"symbol",filterable:!0,sortable:!0,minWidth:65,width:65},{id:"market",name:"Market",field:"market",filterable:!0,sortable:!0,minWidth:75,width:75,grouping:{getter:"market",formatter:t=>`Market: <span style="color: var(--slick-primary-color); font-weight: bold;">${t.value}</span>  <span style="color: #659bff;">(${t.count} items)</span>`,aggregators:[new $.Sum("amount")],aggregateCollapsed:!0,collapsed:!1}},{id:"company",name:"Company",field:"company",filterable:!0,sortable:!0,minWidth:80,width:130},{id:"trsnType",name:"Type",field:"trsnType",filterable:!0,sortable:!0,minWidth:60,width:60,formatter:Ge,filter:{model:y.singleSelect,collection:[{label:"",value:""},{label:"Buy",value:"Buy"},{label:"Sell",value:"Sell"}]},grouping:{getter:"trsnType",formatter:t=>`Type: <span style="color: var(--slick-primary-color); font-weight: bold;">${t.value}</span>  <span style="color: #659bff;">(${t.count} items)</span>`,aggregators:[new $.Sum("amount")],aggregateCollapsed:!0,collapsed:!1}},{id:"priceChange",name:"Change",field:"priceChange",filterable:!0,sortable:!0,minWidth:80,width:80,filter:{model:y.compoundInputNumber},type:T.number,formatter:k.multiple,params:{formatters:[k.dollar,Ae],maxDecimal:2}},{id:"price",name:"Price",field:"price",filterable:!0,sortable:!0,minWidth:70,width:70,filter:{model:y.compoundInputNumber},type:T.number,formatter:k.dollar,params:{maxDecimal:2}},{id:"quantity",name:"Quantity",field:"quantity",filterable:!0,sortable:!0,minWidth:70,width:70,filter:{model:y.compoundInputNumber},type:T.number},{id:"amount",name:"Amount",field:"amount",filterable:!0,sortable:!0,minWidth:70,width:60,filter:{model:y.compoundInputNumber},type:T.number,formatter:k.dollar,params:{maxDecimal:2},groupTotalsFormatter:ge.sumTotalsDollarBold},{id:"historic",name:"Price History",field:"historic",minWidth:100,width:150,maxWidth:150,formatter:$e},{id:"execution",name:"Execution Timestamp",field:"execution",filterable:!0,sortable:!0,minWidth:125,formatter:k.dateTimeIsoAmPm,exportWithFormatter:!0,type:T.dateTimeIsoAM_PM,filter:{model:y.compoundDate}}],this.gridOptions={autoResize:{container:".trading-platform",autoHeight:!1,rightPadding:0,bottomPadding:10},formatterOptions:{displayNegativeNumberWithParentheses:!0,thousandSeparator:","},draggableGrouping:{dropPlaceHolderText:"Drop a column header here to group by any of these available columns: Currency, Market or Type",deleteIconCssClass:"mdi mdi-close text-color-danger",sortAscIconCssClass:"mdi mdi-arrow-up",sortDescIconCssClass:"mdi mdi-arrow-down"},enableDraggableGrouping:!0,createPreHeaderPanel:!0,darkMode:this._darkMode,showPreHeaderPanel:!0,preHeaderPanelHeight:40,enableCellNavigation:!0,enableFiltering:!0,cellHighlightCssClass:"changed"}}getData(){const t=[];for(let e=0;e<Ee;e++){const i=Math.round(Math.random()*100),r=this.randomNumber(1,50),o=this.randomNumber(125,255),l=this.randomNumber(-25,35,!1),s=this.randomNumber(l,300),u=s<5?o:r,a=s*u,c=new Date;c.setHours(9,30,0);const d=Math.floor(Math.random()*10)%2?"CAD":"USD",p=he.company.name();t[e]={id:e,currency:d,trsnType:Math.round(Math.random()*100)%2?"Buy":"Sell",company:p,symbol:d==="CAD"?p.substr(0,3).toUpperCase()+".TO":p.substr(0,4).toUpperCase(),market:d==="CAD"?"TSX":s>200?"Nasdaq":"S&P 500",duration:e%33===0?null:Math.random()*100+"",percentCompleteNumber:i,priceChange:l,price:s,quantity:u,amount:a,execution:c,historic:[s]}}this.dataset=t}startSimulation(){const t={},e=this.randomNumber(this.minChangePerCycle,this.maxChangePerCycle);for(let i=0;i<e;i++){const r=this.randomNumber(1,50),o=this.randomNumber(125,255),l=Math.round(Math.random()*(this.dataset.length-1)),s=this.randomNumber(-25,25,!1),u=ue(this.dataset[l]),a={...this.dataset[l]};a.priceChange=s,a.price=a.price+s<0?0:a.price+s,a.quantity=a.price<5?o:r,a.amount=a.price*a.quantity,a.trsnType=Math.round(Math.random()*100)%2?"Buy":"Sell",a.execution=new Date,a.historic.push(a.price),a.historic=a.historic.slice(-20),t[l]||(t[l]={}),t[l].id="changed",this.renderCellHighlighting(a,this.findColumnById("priceChange"),s),(u.priceChange<0&&a.priceChange>0||u.priceChange>0&&a.priceChange<0)&&this.renderCellHighlighting(a,this.findColumnById("price"),s),this.aureliaGrid.dataView.updateItem(a.id,a)}this.timer=window.setTimeout(this.startSimulation.bind(this),this.refreshRate||0)}stopSimulation(){window.clearTimeout(this.timer)}findColumnById(t){return this.columnDefinitions.find(e=>(e==null?void 0:e.field)===t)}renderCellHighlighting(t,e,i){if(t&&e){const r=this.aureliaGrid.dataView.getRowByItem(t);if(r>=0){const o={[r]:{[e.id]:i>=0?"changed-gain":"changed-loss"}};this.aureliaGrid.slickGrid.setCellCssStyles(`highlight_${[e.id]}${r}`,o),window.setTimeout(()=>this.removeUnsavedStylingFromCell(t,e,r),this.highlightDuration)}}}removeUnsavedStylingFromCell(t,e,i){this.aureliaGrid.slickGrid.removeCellCssStyles(`highlight_${[e.id]}${i}`)}toggleFullScreen(){const t=document.querySelector(".trading-platform");t!=null&&t.classList.contains("full-screen")?(t.classList.remove("full-screen"),this.isFullScreen=!1):t&&(t.classList.add("full-screen"),this.isFullScreen=!0),this.aureliaGrid.resizerService.resizeGrid()}toggleDarkMode(){var t;this._darkMode=!this._darkMode,this.toggleBodyBackground(),(t=this.aureliaGrid.slickGrid)==null||t.setOptions({darkMode:this._darkMode})}toggleBodyBackground(){this._darkMode?(document.querySelector(".panel-wm-content").classList.add("dark-mode"),document.querySelector("#demo-container").dataset.bsTheme="dark"):(document.querySelector(".panel-wm-content").classList.remove("dark-mode"),document.querySelector("#demo-container").dataset.bsTheme="light")}toggleSubTitle(){var e;this.hideSubTitle=!this.hideSubTitle;const t=this.hideSubTitle?"add":"remove";(e=document.querySelector(".subtitle"))==null||e.classList[t]("hidden"),this.aureliaGrid.resizerService.resizeGrid(0)}randomNumber(t,e,i=!0){const r=Math.random()*(e-t+1)+t;return i?Math.floor(r):r}}W=Te();R=Ne(W,0,"Example34",K,R);Fe(W,1,R);export{R as Example34};
//# sourceMappingURL=example34-B440uC4M.js.map
